<!DOCTYPE html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7" lang="en" dir="ltr"><![endif]-->
<!--[if IE 7]><html class="lt-ie9 lt-ie8" lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9" lang="en" dir="ltr"><![endif]-->
<!--[if gt IE 8]><!--><html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->
<head>
<meta charset="utf-8" />
<link rel="shortlink" href="/node/7" />
<link rel="shortcut icon" href="/sites/all/themes/humblebeggining/favicon.ico" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
<link rel="canonical" href="/zend-form-custom-validation" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Zend Form Custom Validation | strayed-bits.net</title>
<link rel="stylesheet" href="/sites/default/files/css/css_xE-rWrJf-fncB6ztZfd2huxqgxu4WO-qwma6Xer30m4.css" media="all" />
<link rel="stylesheet" href="/sites/default/files/css/css_uGbAYUquy_hLL8-4YI1pUCShW2j1u-tewieW2F4S-ks.css" media="all" />
<link rel="stylesheet" href="/sites/default/files/css/css_y7x-E9HU1xpIegvHoNXPU22DGIObba-YNi7929-l8do.css" media="all" />
<link rel="stylesheet" href="/sites/default/files/css/css_WkIQlS2V8h4Vh16HARhGTGX8u2nA_FzvuTZ5-DXLwaQ.css" media="screen" />
<link rel="stylesheet" href="/sites/default/files/css/css_8Na81x0TlPmv0mkfYwNa_rXnluHjk6jVfeDy47i0A6g.css" media="all" />
<link rel="stylesheet" href="/sites/default/files/css/css_5TxylIDFcnpmO5ucPRfXTdJiyW00MUBYhBuo7SANpds.css" media="print" />
<link rel="stylesheet" href="/sites/default/files/css/css_szF50th7JCQ5i-POEGKXQP_VswalbWOHBoB9pdfA5j0.css" media="only screen" />
<link rel="stylesheet" href="/sites/default/files/css/css_RqJOM7P-Bm3_FSClEoZknlX2hqHqo9WVAtkBV6DUX4U.css" media="screen" />
<link rel="stylesheet" href="/sites/default/files/css/css_gccWjowuH2fga-UCn3xqMw9Uiy1zP2lhOgGv8CdwGnY.css" media="only screen" />

<!--[if lt IE 9]>
<link rel="stylesheet" href="/sites/default/files/css/css_-ZfMH-iGLlNE6FZNiIjxRGAkOtmJJKiJ_uqtiYeduqw.css" media="screen" />
<![endif]-->
<script src="/sites/default/files/js/js_xAPl0qIk9eowy_iS9tNkCWXLUVoat94SQT48UBCFkyQ.js"></script>
<script src="/sites/default/files/js/js_fgYrkXtuxzG9Elq7qwZaJnWe7qsPHbpE3Jg3qw1CVcc.js"></script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"humblebeginning","theme_token":"_tDebtdev0s-dBx6aG1xxL3E5qDbFnXAFVNGcFyyH3c","js":{"sites\/all\/modules\/syntaxhighlighter\/syntaxhighlighter.min.js":1,"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shCore.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shBrushCss.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shBrushJScript.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shBrushPhp.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shBrushSql.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shBrushXml.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/styles\/shCore.css":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/styles\/shThemeDefault.css":1,"sites\/all\/themes\/adaptivetheme\/at_core\/css\/at.settings.style.headings.css":1,"sites\/all\/themes\/adaptivetheme\/at_core\/css\/at.settings.style.image.css":1,"sites\/all\/themes\/adaptivetheme\/at_core\/css\/at.layout.css":1,"sites\/all\/themes\/corolla\/css\/html-elements.css":1,"sites\/all\/themes\/corolla\/css\/forms.css":1,"sites\/all\/themes\/corolla\/css\/tables.css":1,"sites\/all\/themes\/corolla\/css\/page.css":1,"sites\/all\/themes\/corolla\/css\/articles.css":1,"sites\/all\/themes\/corolla\/css\/comments.css":1,"sites\/all\/themes\/corolla\/css\/fields.css":1,"sites\/all\/themes\/corolla\/css\/blocks.css":1,"sites\/all\/themes\/corolla\/css\/navigation.css":1,"sites\/all\/themes\/corolla\/css\/fonts.css":1,"sites\/all\/themes\/corolla\/css\/corolla.settings.style.css":1,"sites\/all\/themes\/corolla\/color\/colors.css":1,"sites\/all\/themes\/humblebeggining\/css\/humblebeginning.css":1,"sites\/all\/themes\/corolla\/css\/print.css":1,"public:\/\/adaptivetheme\/humblebeginning_files\/humblebeginning.responsive.layout.css":1,"public:\/\/adaptivetheme\/humblebeginning_files\/humblebeginning.fonts.css":1,"public:\/\/adaptivetheme\/humblebeginning_files\/humblebeginning.responsive.styles.css":1,"public:\/\/adaptivetheme\/humblebeginning_files\/humblebeginning.lt-ie9.layout.css":1}},"adaptivetheme":{"humblebeginning":{"layout_settings":{"bigscreen":"three-col-grail","tablet_landscape":"three-col-grail","tablet_portrait":"one-col-vert"},"media_query_settings":{"bigscreen":"only screen and (min-width:1025px)","tablet_landscape":"only screen and (min-width:769px) and (max-width:1024px)","tablet_portrait":"only screen and (min-width:481px) and (max-width:768px)"}}}});</script>
<!--[if lt IE 9]>
<script src="/sites/all/themes/adaptivetheme/at_core/scripts/html5.js?"></script>
<![endif]-->
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-7 node-type-article atv-0.1 site-name-strayed-bitsnet section-zend-form-custom-validation color-scheme-default humblebeginning bs-n bb-n mb-dd rc-6 rct-6">
  <div id="skip-link" class="nocontent">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="page-wrapper">
  <div id="page" class="page snc-n snw-n sna-l sns-n ssc-n ssw-n ssa-l sss-n btc-n btw-b bta-l bts-n ntc-n ntw-b nta-l nts-n ctc-n ctw-b cta-l cts-n ptc-n ptw-b pta-l pts-n">

          <div id="menu-bar-wrapper">
        <div class="container clearfix">
          <div id="menu-bar" class="nav clearfix"><nav id="block-system-main-menu" class="block block-system block-menu menu-wrapper menu-bar-wrapper clearfix odd first last block-count-1 block-region-menu-bar block-main-menu"  role="navigation">  
      <h2 class="element-invisible block-title">Main menu</h2>
  
  <ul class="menu clearfix"><li class="first leaf menu-depth-1 menu-item-391"><a href="/about">About</a></li><li class="last leaf menu-depth-1 menu-item-218"><a href="/">Home</a></li></ul>
  </nav></div>        </div>
      </div>
    
    <div id="header-wrapper">
      <div class="container clearfix">

        <header class="clearfix with-logo" role="banner">

                      <div id="branding" class="branding-elements clearfix">

                              <div id="logo">
                  <a href="/"><img class="site-logo" typeof="foaf:Image" src="/sites/all/themes/humblebeggining/logo.png" alt="strayed-bits.net" /></a>                </div>
              
                              <div class="h-group" id="name-and-slogan">

                                      <h1 id="site-name"><a href="/" title="Home page">strayed-bits.net</a></h1>
                  
                  
                </div>
              
            </div>
          
          
        </header>

      </div>
    </div>

    
    
    
    <div id="content-wrapper">
      <div class="container">

        <div id="columns">
          <div class="columns-inner clearfix">

            <div id="content-column">
              <div class="content-inner">

                
                <section id="main-content" role="main">

                  
                  <div class="content-margin">
                    <div class="content-style">

                      
                      
                      
                                              <header class="clearfix">
                          <h1 id="page-title">
                            Zend Form Custom Validation                          </h1>
                        </header>
                      
                      
                      
                      <div id="content">
                        <div class="region region-content"><div id="block-system-main" class="block block-system no-title odd first last block-count-2 block-region-content block-main" >  
  
  <article id="node-7" class="node node-article node-promoted article odd node-full ia-n clearfix" role="article">
  <div class="node-inner">

    
              <header class="node-header">

                  <h1 class="node-title">
                          Zend Form Custom Validation                      </h1>
        
                  <p class="submitted">Submitted by <span class="username">Rayhan Muktader</span> on <time datetime="2012-08-09T11:45:17-0400" pubdate="pubdate">Thu, 08/09/2012 - 11:45</time></p>
        
      </header>
        
    <div class="node-content">
        <div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-full"><div class="field-items" id="md1"><div class="field-item even"><p>
In this tutorial we will continue on from the <a href="/stand-alone-zend-form-composite-element">last post</a> and learn how build a custom validation for form elements.
</p>
<p>
The rule of thumb is that you create a folder called "Validate" inside your custom library folder(the RM folder in our case) and inside that folder you create a class that extends Zend_Validate_Abstract and has a isValid($value) method that checks for your custom requirements and return either true or false.
</p>
<p>
It is also important to note that you can take advantage of ZF's error message system by creating a protected array called $_messageTemplates and saving the error messages in it.  Then you simply have to call $this-&gt;_error( YOUR_ERROR_KEY ) and pass in the key for the error message you want.
</p>
<p>
In this silly experiment I create a validator that checks to make sure that there is at least one '5' in the SSN.  You can create a validator check for any rule you please and you can check for multiple rules and have different error messages for different rules.
</p>
<p>
Then you simply add the validator to any form element like so  $element-&gt;addValidator(new RM_Validate_SpecialSsn);
</p>
<p>
Here's the code the validator class:</p>
<pre class="brush:php;">
&lt;?php
/**
 * This validation class makes sure that there's at least one 5 in the value.
 * Much of its functionality comes from the parent class 
 * Zend_Validate_Abstract.
 * This is just a silly example. It can be changed to check for more than one
 * error and used with different form elements.
 *
 * @author Rayhan Muktader &lt;rmuktader(@)gmail.com&gt;
 */
class RM_Validate_SpecialSsn
    extends Zend_Validate_Abstract
{
    const INVALID_SPECIAL_SSN = 'invalidSpecialSsn';
    
    /**
     * @var array $_messageTemplates holds all the names of the errors 
     * and the corresponding error messages
     */
    protected $_messageTemplates = array(
        self::INVALID_SPECIAL_SSN =&gt; "Sorry we are only accepting spcial 
        social security numbers that have at least one 5 in them. %value% 
        is not a special social security number"
    );
    
    
    /**
     * @param string $value the value of the form element
     * @return bool return true if it is a "special" SSN, false otherwise
     */
    public function isValid( $value )
    {
        $isValid = FALSE;
        
        // chech if  the value contains a 5
        if ( strpos( $value, '5' ) !== FALSE ) {
            $isValid = TRUE;
        } else {
        
            // sets the value in the form element and makes it available to
            // be printed out in the error message
            $this-&gt;_setValue( $value );
            
            $this-&gt;_error( self::INVALID_SPECIAL_SSN );
        }
        
        return $isValid;
    }
}
</pre>
<p>
Here the altered code for form.php:</p>
<pre class="brush:php;">
&lt;?php
error_reporting(E_ALL);
ini_set('display_errors', '1');
/**
 * @file form.php
 */
 
// Load Zend Framework
set_include_path(
        implode(PATH_SEPARATOR, array(
                get_include_path(),
                __DIR__ .'/'
        ))
);
        
// Create the auto loader so zend can load the rest automatically
require_once 'Zend/Loader/Autoloader.php';
$autoloader = Zend_Loader_Autoloader::getInstance();

// load custom namspace
// in ZF MVC it would be autoloaderNamespaces[] = RM
$autoloader-&gt;registerNamespace( 'RM' ); 

$form = new Zend_Form;

// Set form name, id, method and action
$form-&gt;setName( 'contact' )
    -&gt;setAttrib( 'id', 'form-contact' )
    -&gt;setMethod( 'post' )
    -&gt;setAction( 'http://'.
        $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'] 
    );

// Create text box for name
$name = new Zend_Form_Element_Text( 'name' );
$name-&gt;setRequired( TRUE )
    -&gt;setAttrib( 'id', 'fullname' )
    -&gt;addErrorMessage( 'Please provide your name' );

// Create a custom composite element for SSn
$ssn = new RM_Form_Element_Ssn( 'ssn' );    
$ssn-&gt;setRequired( TRUE )
    -&gt;setAttrib( 'id', 'ssn' )
    -&gt;addValidator( new Zend_Validate_NotEmpty )
    -&gt;addValidator( new RM_Validate_SpecialSsn );
    
// Using addErrorMessage orvrrides all error messages, including the one
// returned by RM_Validate_SpecialSsn.  
// The custom element does not set the values if it is not a valid SSN. 
// In those cases, it actually failes the NotEmpty validation.
// I am setting a error message specificly for those cases. This way there
// is no conflict with other other validation messages
    $ssn-&gt;getValidator('NotEmpty')-&gt;setMessage( 'Please provide a valid SSN' );

    
// Create text box for email        
$email = new Zend_Form_Element_Text( 'email' );
$email-&gt;setRequired( TRUE )
    -&gt;setAttrib( 'id', 'email' )
    -&gt;addErrorMessage( 'Please provide a valid e-mail address' );

// Create text area for message    
$message = new Zend_Form_Element_Textarea( 'message' );
$message-&gt;setRequired( TRUE )
    -&gt;setAttrib( 'id', 'message' )
    -&gt;addErrorMessage( 'Please specify a message' );

// Create a submit button    
$submit = new Zend_Form_Element_Submit( 'submit' );
$submit-&gt;setLabel( 'Send Your Message!' )
    -&gt;setAttrib( 'id', 'submit' );

// Set the ViewScript decorator for the form and tell it which 
// template file to use
$form-&gt;setDecorators( array( 
    array( 'ViewScript', array( 'viewScript' =&gt; 'form-contact.tpl.php' ) ) ) );

// Add the form elements AFTER the viewscript decorator has been set
$form-&gt;addElements( array( $name, $ssn, $email, $message, $submit ) );

// Get rid of all element decorators except for ViewHelper to render
// the individual elements and Errors decorator to render the errors.
$form-&gt;setElementDecorators( array( 'ViewHelper', 'Errors' ) );
    
// Create an instance of Zend_View and set the directory 
// for the template files
$view = new Zend_View();
$view-&gt;setScriptPath( __DIR__ );
$view-&gt;addHelperPath( __DIR__ . '/RM/View/Helper', 'RM_View_Helper' );

// Tell all the elements in the form which view to use when rendering
foreach ($form as $item){
    $item-&gt;setView($view);
}

// process or display the form
if( isset( $_POST['submit'] ) &amp;&amp; ( $form-&gt;isValid( $_POST ) ) ) {
    echo 'Thank you';
} else {
    echo $form-&gt;render( $view );
}
</pre>
<p>
Here's the <a href="/examples/zf-stand-alone-form-with-composite-element-and-custom-validator/">demo</a> and <a href="https://github.com/rmuktader/zf-custom-validation">download</a>.
</p>
</div></div></div><section class="field field-name-field-tags field-type-taxonomy-term-reference field-label-above view-mode-full"><h2 class="field-label">Tags:&nbsp;</h2><ul class="field-items"><li class="field-item even" id="md2"><a href="/tags/zend-framework-1x" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">zend-framework-1.X</a></li><li class="field-item odd" id="md4"><a href="/tags/zend-form" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">zend-form</a></li><li class="field-item even" id="md6"><a href="/tags/zend-validate" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">zend-validate</a></li></ul></section>    </div>

    
    
  </div>
</article>

  </div><meta  itemscope="" itemid="/zend-form-custom-validation" itemref="md1 md3 md5 md7" /><meta  itemscope="" itemid="/tags/zend-framework-1x" id="md3" itemref="md2" /><meta  itemscope="" itemid="/tags/zend-form" id="md5" itemref="md4" /><meta  itemscope="" itemid="/tags/zend-validate" id="md7" itemref="md6" /></div>                      </div>

                      
                    </div>
                  </div>

                </section>

                
              </div>
            </div>

                        
          </div>
        </div>

      </div>
    </div>

    
    
          <div id="footer-wrapper">
        <div class="container clearfix">
          <footer class="clearfix" role="contentinfo">
            <div class="region region-footer"><div class="region-inner clearfix"><div id="block-system-powered-by" class="block block-system no-title odd first last block-count-3 block-region-footer block-powered-by"  role="complementary"><div class="block-inner clearfix">  
  
  <div class="block-content content"><span>Powered by <a href="https://www.drupal.org">Drupal</a></span></div>
  </div></div></div></div>            <p class="attribute-creator"></p>
          </footer>
        </div>
      </div>
    
  </div>
</div>
  <script src="/sites/default/files/js/js_Rk5YIkK6m2gKTGH-GrMu0pM_PlMKXnI0ktQUgXw1XgA.js"></script>
</body>
</html>
